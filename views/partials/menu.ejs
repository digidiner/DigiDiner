<div class="container-fluid justify-content-lg-start">
    <div class="row">
        <div class="col-12">
            <div class="container-fluid justify-content-lg-start">
                <h1 id="menu">Menu</h1>
                <div class="accordion" id="menuAccordion">
                    <% menuItems.forEach((item, index) => { %>
                        <div class="accordion-item">
                            <!-- Update accordion-header and button to refer to 'menu' -->
                            <h2 class="accordion-header" id="heading<%= index %>">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapse<%= index %>" aria-expanded="true"
                                        aria-controls="collapse<%= index %>">
                                    <%= item.name %>
                                    <span class="badge bg-primary">$<%= item.price.toFixed(2) %></span>
                                </button>
                            </h2>
                            <div id="collapse<%= index %>" class="accordion-collapse collapse"
                                 aria-labelledby="heading<%= index %>" data-bs-parent="#menuAccordion">
                                <div class="accordion-body">
                                    <h5>Select Modifications:</h5>
                                    <ul class="list-group">
                                        <% item.modifications.forEach((modification) => { %>
                                            <li class="list-group-item">
                                                <!-- Update form-check and label to refer to 'modification.id' -->
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="<%= modification.name %>"
                                                           id="<%= modification.id %>">
                                                    <label class="form-check-label" for="<%= modification.id %>">
                                                        <%= modification.name %>
                                                        <span class="badge bg-secondary">$<%= modification.price.toFixed(2) %></span>
                                                    </label>
                                                </div>
                                            </li>
                                        <% }) %>
                                    </ul>
                                    <!-- Update form-group IDs to refer to 'index' -->
                                    <div class="form-group mt-3">
                                        <label for="allergyDropdown<%= index %>">Allergy:</label>
                                        <select class="form-control" id="allergyDropdown<%= index %>">
                                            <option value="">None</option>
                                            <option value="Peanuts">Peanuts</option>
                                            <option value="Gluten">Gluten</option>
                                            <option value="Dairy">Dairy</option>
                                            <option value="Shellfish">Shellfish</option>
                                        </select>
                                    </div>
                                    <div class="form-group mt-3">
                                        <label for="specialRequests<%= index %>">Special Requests:</label>
                                        <textarea class="form-control" id="specialRequests<%= index %>" rows="3"></textarea>
                                    </div>
                                    <!-- Update addToOrder function call -->
                                    <button class="btn btn-primary mt-3" onclick="addToOrder('<%= index %>')">Add to Order</button>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function addToOrder(index) {
        // Get the selected modifications
        var selectedModifications = [];
        var modificationCheckboxes = document.querySelectorAll(
            '#collapse' + index + ' input[type="checkbox"]:checked'
        );
        modificationCheckboxes.forEach(function (checkbox) {
            selectedModifications.push(checkbox.value);
        });

        // Get the selected allergy
        var allergyDropdown = document.getElementById('allergyDropdown' + index);
        var selectedAllergy = allergyDropdown.value;

        // Get the special requests
        var specialRequestsTextarea = document.getElementById('specialRequests' + index);
        var specialRequests = specialRequestsTextarea.value;

        // Create an object with the selected item and its details
        var orderItem = {
            itemIndex: index,
            modifications: selectedModifications,
            allergy: selectedAllergy,
            specialRequests: specialRequests
        };

        // Add the order item to the current order
        addToCurrentOrder(orderItem);

        // Display a success message or perform any other actions
        alert('Item added to the order!');
    }

    function addToCurrentOrder(orderItem) {
        // Add logic to add order item to current order
        console.log(orderItem);
    }

    // Gets all menu items that anyone can do
    window.onload = () => {
        fetch('/api/menu')
            .then(response => response.json())
            .then(data => console.log(data))
    //         // {
    //         //     //update the UI with the received data
    //         //     const menuContainer = document.getElementById('menuContainer');
    //         //     menuContainer.innerHTML = '';
    //         //
    //         //     data.forEach(menuItem => {
    //         //         const menuItemElement = document.createElement('div');
    //         //         menuItemElement.textContent = menuItem.name;
    //         //         menuContainer.appendChild(menuItemElement);
    //         //     });
    //         // })
    //         .catch(err => {
    //             console.error('Error fetching menu data');
    //         });
    };

</script>
