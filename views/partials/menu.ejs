<div class="container-fluid justify-content-lg-start">
    <div class="row">
        <div class="col-12">
            <h1 id="menu">Menu</h1>
            <div class="accordion" id="menuAccordion">
                <% menuItems.forEach((item, index)=> { %>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading<%= index %>">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapse<%= index %>" aria-expanded="true"
                                aria-controls="collapse<%= index %>">
                                <%= item.name %>
                                    <span class="badge bg-primary">$<%= item.price.toFixed(2) %></span>
                            </button>
                        </h2>
                        <div id="collapse<%= index %>" class="accordion-collapse collapse"
                            aria-labelledby="heading<%= index %>" data-bs-parent="#menuAccordion">
                            <div class="accordion-body">
                                <h5>Select Modifications:</h5>
                                <ul class="list-group">
                                    <% item.modifications.forEach((modification)=> { %>
                                        <li class="list-group-item">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox"
                                                    value="<%= modification.name %>" id="<%= modification.id %>">
                                                <label class="form-check-label" for="<%= modification.id %>">
                                                    <%= modification.name %>
                                                        <span class="badge bg-secondary">$<%=
                                                                modification.price.toFixed(2) %></span>
                                                </label>
                                            </div>
                                        </li>
                                        <% }) %>
                                </ul>
                                <div class="form-group mt-3">
                                    <label for="allergyDropdown<%= index %>">Allergy:</label>
                                    <select class="form-control" id="allergyDropdown<%= index %>">
                                        <option value="">None</option>
                                        <option value="Peanuts">Peanuts</option>
                                        <option value="Gluten">Gluten</option>
                                        <option value="Dairy">Dairy</option>
                                        <option value="Shellfish">Shellfish</option>
                                    </select>
                                </div>
                                <div class="form-group mt-3">
                                    <label for="specialRequests<%= index %>">Special Requests:</label>
                                    <textarea class="form-control" id="specialRequests<%= index %>" rows="3"></textarea>
                                </div>
                                <button class="btn btn-primary mt-3" onclick="addToOrder('<%= index %>')">Add to
                                    Order</button>
                            </div>
                        </div>
                    </div>
                    <% }) %>
            </div>
            <h2>Menu Options</h2>
            <ul>
                <% menuOptions.forEach((option)=> { %>
                    <li>
                        <%= option.name %>
                    </li>
                    <% }) %>
            </ul>
            <h2>Menu Associations</h2>
            <ul>
                <% menuAssociations.forEach((association)=> { %>
                    <li>Menu Item ID: <%= association.menu_item_id %>, Option ID: <%= association.option_id %>
                    </li>
                    <% }) %>
            </ul>
        </div>
    </div>
</div>
<script>
    function addToOrder(index) {
        // Get the selected modifications
        var selectedModifications = [];
        var modificationCheckboxes = document.querySelectorAll(
            '#collapse' + index + ' input[type="checkbox"]:checked'
        );
        modificationCheckboxes.forEach(function (checkbox) {
            selectedModifications.push(checkbox.value);
        });

        // Get the selected allergy
        var allergyDropdown = document.getElementById('allergyDropdown' + index);
        var selectedAllergy = allergyDropdown.value;

        // Get the special requests
        var specialRequestsTextarea = document.getElementById('specialRequests' + index);
        var specialRequests = specialRequestsTextarea.value;

        // Create an object with the selected item and its details
        var orderItem = {
            itemIndex: index,
            modifications: selectedModifications,
            allergy: selectedAllergy,
            specialRequests: specialRequests
        };

        // Add the order item to the current order
        addToCurrentOrder(orderItem);

        // Display a success message or perform any other actions
        alert('Item added to the order!');
    }

    function addToCurrentOrder(orderItem) {
        // Add logic to add order item to current order
        console.log(orderItem);
    }

    // Gets all menu items that anyone can do
    window.onload = () => {
        fetch('/api/menu')
            .then(response => response.json())
            .then(data => {
                const menuItems = data;
                renderMenu(menuItems);
            })
            .catch(error => {
                console.error('Error fetching menu data', error);
            });
    };

    function renderMenu(menuItems) {
        const menuAccordion = document.getElementById('menuAccordion');

        // Clear any existing menu items
        menuAccordion.innerHTML = '';

        // Loop through the menu items and generate the HTML markup
        menuItems.forEach((item, index) => {
            // Convert the price to a decimal if it is a string
            const price = typeof item.price === 'string' ? parseFloat(item.price) : item.price;

            // Check if the price is a valid decimal number
            if (!isNaN(price)) {
                const accordionItem = document.createElement('div');
                accordionItem.classList.add('accordion-item');

                const accordionHeader = document.createElement('h2');
                accordionHeader.classList.add('accordion-header');
                accordionHeader.id = 'heading' + index;

                const accordionButton = document.createElement('button');
                accordionButton.classList.add('accordion-button');
                accordionButton.setAttribute('type', 'button');
                accordionButton.setAttribute('data-bs-toggle', 'collapse');
                accordionButton.setAttribute('data-bs-target', '#collapse' + index);
                accordionButton.setAttribute('aria-expanded', 'true');
                accordionButton.setAttribute('aria-controls', 'collapse' + index);
                accordionButton.innerHTML = item.name + '<span class="badge bg-primary">$' + price.toFixed(2) + '</span>';

                const accordionCollapse = document.createElement('div');
                accordionCollapse.id = 'collapse' + index;
                accordionCollapse.classList.add('accordion-collapse', 'collapse');
                accordionCollapse.setAttribute('aria-labelledby', 'heading' + index);
                accordionCollapse.setAttribute('data-bs-parent', '#menuAccordion');

                const accordionBody = document.createElement('div');
                accordionBody.classList.add('accordion-body');
                accordionBody.innerHTML = '<p>' + item.description + '</p>';

                accordionCollapse.appendChild(accordionBody);
                accordionHeader.appendChild(accordionButton);
                accordionItem.appendChild(accordionHeader);
                accordionItem.appendChild(accordionCollapse);
                menuAccordion.appendChild(accordionItem);
            }
        });
    }


</script>